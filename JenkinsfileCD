node {
  stage('SCM') {
    checkout scm
  }
  // stage('Install and Build') { 
  //   nodejs(nodeJSInstallationName: 'NodeJS') {
  //     sh 'npm install'
  //     sh 'ng build --configuration=production'
  //   }
  // }
  stage('Deploy') {
    //sshagent(credentials: ['nginx']) {
      sh '''
        date_backup=backup-$(date +%d)-$(date +%m)-$(date +%Y)-$(date +%H):$(date +%M):$(date +%S)
        pathDeploy=./DeployWeb
        pathDeployWeb=$pathDeploy/www
        pathDeployBackup=$pathDeploy/backup
        ssh remote_jenkins@nginx mkdir $pathDeployBackup/$date_backup
        ssh remote_jenkins@nginx mv $pathDeployWeb/* $pathDeployBackup/$date_backup
        scp -r /var/jenkins_home/workspace/MTM-Web-CD/dist/DeyApps/* remote_jenkins@nginx:$pathDeployWeb
      '''
    //}
      
    //   sh 'ssh -tt remote_jenkins@nginx'
    //   sh 'ls -la'
    //   sh 'cd ./DeployWeb'
    //   sh 'date_backup=backup-$(date +%d)-$(date +%m)-$(date +%Y)-$(date +%H):$(date +%M):$(date +%S)'
    //   sh 'mkdir $date_backup'
    //   sh 'mv ./www/* ./backup/$date_backup'
      
  }
  post {
        always {
            echo 'This will always run'
        }
        success {
            echo 'This will run only if successful'
        }
        failure {
            echo 'This will run only if failed'
        }
        unstable {
            echo 'This will run only if the run was marked as unstable'
        }
        changed {
            echo 'This will run only if the state of the Pipeline has changed'
            echo 'For example, if the Pipeline was previously failing but is now successful'
        }
    }
}
